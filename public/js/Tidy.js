!function(e,t,r,n,o){var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},a="function"==typeof i[n]&&i[n],u=a.cache||{},c="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function s(t,r){if(!u[t]){if(!e[t]){var o="function"==typeof i[n]&&i[n];if(!r&&o)return o(t,!0);if(a)return a(t,!0);if(c&&"string"==typeof t)return c(t);var l=Error("Cannot find module '"+t+"'");throw l.code="MODULE_NOT_FOUND",l}p.resolve=function(r){var n=e[t][1][r];return null!=n?n:r},p.cache={};var f=u[t]=new s.Module(t);e[t][0].call(f.exports,p,f,f.exports,i)}return u[t].exports;function p(e){var t=p.resolve(e);return!1===t?{}:s(t)}}s.isParcelRequire=!0,s.Module=function(e){this.id=e,this.bundle=s,this.exports={}},s.modules=e,s.cache=u,s.parent=a,s.register=function(t,r){e[t]=[function(e,t){t.exports=r},{}]},Object.defineProperty(s,"root",{get:function(){return i[n]}}),i[n]=s;for(var l=0;l<t.length;l++)s(t[l]);if(r){var f=s(r);"object"==typeof exports&&"undefined"!=typeof module?module.exports=f:"function"==typeof define&&define.amd&&define(function(){return f})}}({"68WsM":[function(e,t,r,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(r),o.export(r,"drawPoint",()=>f),o.export(r,"drawLine",()=>p),o.export(r,"drawRect",()=>d),o.export(r,"getColorCode",()=>v),o.export(r,"setLineDash",()=>x),o.export(r,"strokeColor",()=>m),o.export(r,"fillColor",()=>h),o.export(r,"strokeWidth",()=>g),o.export(r,"getSize",()=>_),o.export(r,"getRectSize",()=>E),o.export(r,"setCanvasById",()=>j),o.export(r,"createCanvas",()=>C),o.export(r,"initializeCanvas",()=>w),o.export(r,"duplicateCanvas",()=>b),o.export(r,"rotateCanvas",()=>O),o.export(r,"rotateCanvasCW",()=>I),o.export(r,"rotateCanvasCCW",()=>M),o.export(r,"state",()=>N),o.export(r,"isEditMode",()=>F),o.export(r,"scaleDrawSize",()=>P),o.export(r,"scalePoint",()=>B),o.export(r,"calcDist",()=>R),o.export(r,"transform",()=>A),o.export(r,"drawCheckerBoard",()=>W),o.export(r,"drawImage",()=>q),o.export(r,"drawInput",()=>V),o.export(r,"drawOutput",()=>L),o.export(r,"invokeDraw",()=>z),o.export(r,"invokeDrawInput",()=>X),o.export(r,"invokeDrawOutput",()=>U),o.export(r,"getNearestCornerPointIndex",()=>G),o.export(r,"setImage",()=>H),o.export(r,"setCorners",()=>J),o.export(r,"setCursor",()=>Y),o.export(r,"setEditPointIndex",()=>K),o.export(r,"getBasename",()=>Q),o.export(r,"setSaveName",()=>Z),o.export(r,"loadImage",()=>ee),o.export(r,"invokeLoadImage",()=>et),o.export(r,"mousemove",()=>er),o.export(r,"invokeMousemove",()=>en),o.export(r,"click",()=>eo),o.export(r,"invokeClick",()=>ei),o.export(r,"saveCanvas",()=>ea),o.export(r,"rotatePoint",()=>eu),o.export(r,"rotate",()=>ec),o.export(r,"save",()=>es),o.export(r,"invokeDragOver",()=>el),o.export(r,"invokeDrop",()=>ef);var i=e("rescript/lib/es6/caml.js"),a=e("./ColorCode.js"),u=e("rescript/lib/es6/caml_int32.js"),c=e("./ConvexHull.js"),s=e("rescript/lib/es6/caml_option.js"),l=e("@rescript/core/src/Core__Option.js"),f=function(e,t){let[r,n]=t,o=e.getContext("2d");return o.beginPath(),o.arc(r,n,5,0,2*Math.PI),o.fillStyle="red",o.fill(),e},p=function(e,t,r){let[n,o]=t,[i,a]=r,u=e.getContext("2d");return u.beginPath(),u.moveTo(n,o),u.lineTo(i,a),u.stroke(),e},d=function(e,t,r){let[n,o]=t,[i,a]=r;return e.getContext("2d").fillRect(n,o,i,a),e},v=function(e){return"rgb("+e[0]+","+e[1]+","+e[2]+")"},x=function(e,t){return e.getContext("2d").setLineDash(t),e},m=function(e,t){return e.getContext("2d").strokeStyle=v(t),e},h=function(e,t){return e.getContext("2d").fillStyle=v(t),e},g=function(e,t){return e.getContext("2d").lineWidth=t,e},_=function(e){return[e.width,e.height]},E=function(e){let t=$(e)[0];t.getContext("2d");let r=t.getBoundingClientRect();return[r.width,r.height]},j=function(e,t){let r=$(t)[0].getContext("2d");r.canvas.width=e.width,r.canvas.height=e.height,r.drawImage(e,0,0)},C=function(e){let[t,r]=e,n=document.createElement("canvas");return n.width=t,n.height=r,n},w=function(e,t){let r=new FileReader;r.readAsDataURL(e),r.onload=function(){let e=r.result,n=new Image;n.src=e,n.onload=function(){let e=C([n.width,n.height]);e.getContext("2d").drawImage(n,0,0),t(e)}}},b=function(e){let t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t},O=function(e,t){let r=document.createElement("canvas"),n=r.getContext("2d");return r.width=e.height,r.height=e.width,n.save(),n.translate(r.width/2,r.height/2),n.rotate(t),n.drawImage(e,-e.width/2,-e.height/2),n.restore(),r};function I(e){return O(e,Math.acos(-1)/2)}function M(e){return O(e,-Math.acos(-1)/2)}var S={contents:void 0},k={contents:C([0,0])},y={contents:[-1,-1]},D={contents:[[0,0],[0,0],[0,0],[0,0]]},T={contents:void 0},N={canvas:S,image:k,cursor:y,corners:D,editPointIndex:T};function F(e){return void 0!==e.editPointIndex.contents}function P(e,t){var r=_(e),n=E("#inputCanvas");return t*Math.max(1,Math.max(r[0],r[1])/Math.max(n[0],n[1]))|0}function B(e,t){var r=_(e),n=E("#inputCanvas");return[u.div(Math.imul(t[0],r[0]),n[0]),u.div(Math.imul(t[1],r[1]),n[1])]}function R(e,t){return 0|Math.sqrt(Math.pow(t[0]-e[0]|0,2)+Math.pow(t[1]-e[1]|0,2))}var A=function(e,t){let r=e.getContext("2d"),[n,o,i,a]=t,u=Math.max(R(n,o),R(i,a)),c=Math.max(R(n,a),R(o,i)),s=fx.canvas(),l=s.texture(e);return s.draw(l).perspective([...n,...o,...i,...a],[0,0,u,0,u,c,0,c]).update(),e.width=u,e.height=c,r.drawImage(s,0,0),e};function W(e){for(var t=_(e),r=t[1],n=t[0],o=P(e,12),i=e,u=0,c=0;;){var s=c,l=u,f=i,p=Math.imul(l,o),v=Math.imul(s,o);if(v>=r)return f;if(p>=n){c=s+1|0,u=0;continue}u=l+1|0,i=d(h(f,(l+s|0)%2==0?a.lightGray:a.white),[p,v],[o,o])}}function q(e){return function(e,t){let r=e.getContext("2d"),n=Math.max(t.width,t.height);return r.drawImage(t,(n-t.width)/2,(n-t.height)/2),e}(e,k.contents)}function V(e){var t=function(e,t,r){var n=void 0!==r?r:a.black,o=t[1],i=t[0],u=function(e,t,r){var n=P(e,r);return d(h(e,t),[i-(n/2|0)|0,o-(n/2|0)|0],[n,n])};return u(u(u(e,n,16),a.white,12),n,8)},r=function(e){var r,n=D.contents,o=n[3],i=n[2],u=n[1],c=n[0];if(F(N)){var s=y.contents;switch(l.getExn(T.contents,void 0)){case 0:r=[s,u,i,o];break;case 1:r=[c,s,i,o];break;case 2:r=[c,u,s,o];break;case 3:r=[c,u,i,s];break;default:throw{RE_EXN_ID:"Assert_failure",_1:["Tidy.res",304,13],Error:Error()}}}else r=[c,u,i,o];var f=r[3],d=r[2],v=r[1],x=r[0];return t(t(t(t(p(p(p(p(m(g(e,P(e,6)),a.red),x,v),v,d),d,f),f,x),x,void 0),v,void 0),d,void 0),f,void 0)}(q(W(e)));if(!F(N))return r;var n=_(r),o=y.contents,i=o[1],u=o[0];return t(p(p(m(x(r,[P(r,10)]),a.black),[u,0],[u,n[1]]),[0,i],[n[0],i]),[u,i],a.red)}function L(e){return A(q(W(e)),D.contents)}function z(e,t){var r=S.contents;if(void 0!==r)return j(t(b(s.valFromOption(r))),e)}function X(){z("#inputCanvas",V)}function U(){z("#outputCanvas",L)}function G(e){var t=D.contents,r=[t[0],t[1],t[2],t[3]].map(function(t){return R(e,t)}),n=r.toSorted(i.int_compare)[0];return r.indexOf(n)}function H(e,t){e.image.contents=t}function J(e,t){var r=c.hull([t[0],t[1],t[2],t[3]]);4===r.length?e.corners.contents=[r[0],r[1],r[2],r[3]]:e.corners.contents=t,z("#inputCanvas",V),z("#outputCanvas",L)}function Y(e,t){e.cursor.contents=t,z("#inputCanvas",V)}function K(e,t){e.editPointIndex.contents=t,z("#inputCanvas",V)}var Q=function(e){let t=e.name.lastIndexOf(".");return -1==t?e.name:e.name.substring(0,t)},Z=e=>$("#file_name").val(e);function ee(e){var t=e[0];Z("corrected_"+Q(t)),w(t,function(e){var t=_(e),r=t[1],n=t[0],o=n<r?r:n;S.contents=s.some(C([o,o])),k.contents=e;var i=o/8|0;J(N,[[i<<1,i<<1],[Math.imul(6,i),i<<1],[i,Math.imul(6,i)],[Math.imul(7,i),Math.imul(6,i)]])})}var et=e=>ee(e.target.files);function er(e){if(F(N))return Y(N,B(l.getExn(S.contents,void 0),e))}var en=e=>er([e.offsetX,e.offsetY]);function eo(e){var t,r=S.contents;if(void 0!==r){var n=B(s.valFromOption(r),e);if(Y(N,n),!F(N))return K(N,G(n));var o=l.getExn(T.contents,void 0),i=D.contents,a=i[3],u=i[2],c=i[1],f=i[0];switch(K(N,void 0),o){case 0:t=[n,c,u,a];break;case 1:t=[f,n,u,a];break;case 2:t=[f,c,n,a];break;case 3:t=[f,c,u,n];break;default:throw{RE_EXN_ID:"Assert_failure",_1:["Tidy.res",462,13],Error:Error()}}J(N,t)}}var ei=e=>eo([e.offsetX,e.offsetY]),ea=function(e){let t=document.createElement("a");t.download=$("#file_name").val()+".jpg",t.href=e.toDataURL("image/jpg"),t.click()};function eu(e,t,r){var n,o,i,a=function(e,t){return[e[0]+t[0]|0,e[1]+t[1]|0]},u=t[1],c=t[0];return a((o=(n=a(e,[0|-c,0|-u]))[1],i=n[0],"CCW"===r?[o,0|-i]:[0|-o,i]),[c,u])}function ec(e){var t=S.contents;if(void 0!==t){k.contents=("CCW"===e?M:I)(k.contents);var r=D.contents,n=_(s.valFromOption(t)),o=[n[0]/2|0,n[1]/2|0];J(N,[eu(r[0],o,e),eu(r[1],o,e),eu(r[2],o,e),eu(r[3],o,e)])}}function es(){var e=S.contents;if(void 0!==e)return ea(L(b(s.valFromOption(e))))}var el=e=>e.preventDefault(),ef=function(e){e.preventDefault(),ee(e.originalEvent.dataTransfer.files)};$(document).ready(function(){$("#load").on("change",et),$("#inputCanvas").mousemove(en),$("#inputCanvas").on("click",ei),$("#cw").on("click",function(){ec("CW")}),$("#ccw").on("click",function(){ec("CCW")}),$("#save").on("click",es),$(document).on("dragover",el),$(document).on("drop",ef)})},{"rescript/lib/es6/caml.js":"7scqq","./ColorCode.js":"fgi4l","rescript/lib/es6/caml_int32.js":"aniu3","./ConvexHull.js":"9oJS8","rescript/lib/es6/caml_option.js":"lBDcT","@rescript/core/src/Core__Option.js":"4Dake","@parcel/transformer-js/src/esmodule-helpers.js":"jBTt3"}],"7scqq":[function(e,t,r,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");function i(e,t){return e<t?-1:+(e!==t)}function a(e,t){return e?+!t:t?-1:0}function u(e,t){return e===t?0:e<t?-1:e>t||e==e?1:t==t?-1:0}function c(e,t){return e<t?-1:+(e!==t)}function s(e,t){return e===t?0:e<t?-1:1}function l(e,t){return e?t:e}function f(e,t){return e<t?e:t}function p(e,t){return e<t?e:t}function d(e,t){return e<t?e:t}function v(e,t){return e||t}function x(e,t){return e>t?e:t}function m(e,t){return e>t?e:t}function h(e,t){return e>t?e:t}function g(e,t){return e[1]===t[1]&&e[0]===t[0]}function _(e,t){var r=t[0],n=e[0];return n>r||!(n<r)&&e[1]>=t[1]}function E(e,t){return!g(e,t)}function j(e,t){return!_(e,t)}function C(e,t){return e[0]>t[0]||!(e[0]<t[0])&&e[1]>t[1]}function w(e,t){return!C(e,t)}function b(e,t){return _(e,t)?t:e}function O(e,t){return C(e,t)?e:t}o.defineInteropFlag(r),o.export(r,"int_compare",()=>i),o.export(r,"bool_compare",()=>a),o.export(r,"float_compare",()=>u),o.export(r,"bigint_compare",()=>c),o.export(r,"string_compare",()=>s),o.export(r,"bool_min",()=>l),o.export(r,"int_min",()=>f),o.export(r,"float_min",()=>p),o.export(r,"string_min",()=>d),o.export(r,"bool_max",()=>v),o.export(r,"int_max",()=>x),o.export(r,"float_max",()=>m),o.export(r,"string_max",()=>h),o.export(r,"i64_eq",()=>g),o.export(r,"i64_neq",()=>E),o.export(r,"i64_lt",()=>j),o.export(r,"i64_gt",()=>C),o.export(r,"i64_le",()=>w),o.export(r,"i64_ge",()=>_),o.export(r,"i64_min",()=>b),o.export(r,"i64_max",()=>O)},{"@parcel/transformer-js/src/esmodule-helpers.js":"jBTt3"}],jBTt3:[function(e,t,r,n){r.interopDefault=function(e){return e&&e.__esModule?e:{default:e}},r.defineInteropFlag=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.exportAll=function(e,t){return Object.keys(e).forEach(function(r){"default"===r||"__esModule"===r||Object.prototype.hasOwnProperty.call(t,r)||Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[r]}})}),t},r.export=function(e,t,r){Object.defineProperty(e,t,{enumerable:!0,get:r})}},{}],fgi4l:[function(e,t,r,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");function i(e){return console.assert(0<=e&&e<=255,"Scale error"),[e,e,e]}function a(e,t,r){console.assert(0<=e&&e<=360,"Scale error"),console.assert(0<=t&&t<=100,"Scale error"),console.assert(0<=r&&r<=100,"Scale error");var n,o=function(e){return 0|Math.round(255*e)},i=t/100,a=r/100;if(0===t){var u=o(a);return[u,u,u]}var c=e/60,s=0|Math.floor(c),l=c-s,f=a*(1-i),p=a*(1-i*l),d=a*(1-i*(1-l));switch(s){case 0:n=[a,d,f];break;case 1:n=[p,a,f];break;case 2:n=[f,a,d];break;case 3:n=[f,p,a];break;case 4:n=[d,f,a];break;default:n=[a,f,p]}return[o(n[0]),o(n[1]),o(n[2])]}o.defineInteropFlag(r),o.export(r,"grayScale",()=>i),o.export(r,"hsv",()=>a),o.export(r,"black",()=>u),o.export(r,"dark",()=>c),o.export(r,"gray",()=>s),o.export(r,"lightGray",()=>l),o.export(r,"white",()=>f),o.export(r,"red",()=>p),o.export(r,"yellow",()=>d),o.export(r,"blue",()=>v),o.export(r,"lightBlue",()=>x),o.export(r,"orange",()=>m);var u=i(0),c=i(30),s=i(120),l=i(180),f=i(255),p=a(18,80,100),d=a(57,80,100),v=a(200,80,100),x=a(200,20,100),m=a(40,80,100)},{"@parcel/transformer-js/src/esmodule-helpers.js":"jBTt3"}],aniu3:[function(e,t,r,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");function i(e,t){if(0===t)throw{RE_EXN_ID:"Division_by_zero",Error:Error()};return e/t|0}function a(e,t){if(0===t)throw{RE_EXN_ID:"Division_by_zero",Error:Error()};return e%t}o.defineInteropFlag(r),o.export(r,"div",()=>i),o.export(r,"mod_",()=>a)},{"@parcel/transformer-js/src/esmodule-helpers.js":"jBTt3"}],"9oJS8":[function(e,t,r,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(r),o.export(r,"cross",()=>a),o.export(r,"ccw",()=>u),o.export(r,"hull",()=>c);var i=e("rescript/lib/es6/caml_int32.js");function a(e,t){return e[0]*t[1]-e[1]*t[0]}function u(e,t,r){var n=t[1],o=t[0];return a([o-e[0],n-e[1]],[r[0]-o,r[1]-n])>0}function c(e){var t=e.map(function(e){return[e[0],e[1]]}).toSorted(function(e,t){return e[0]+e[1]-(t[0]+t[1])}),r=t.length,n=function(e){for(var n=0,o=i.mod_(e+1|0,r);;){var a=o,c=n;if(c>=r)return a;o=u(t[e],t[c],t[a])?c:a,n=c+1|0}};if(r<=2)return[];var o=[];return!function(e){for(;;){var r=e,i=t[r];o.push([0|i[0],0|i[1]]);var a=n(r);if(0===a)return;e=a}}(0),o}},{"rescript/lib/es6/caml_int32.js":"aniu3","@parcel/transformer-js/src/esmodule-helpers.js":"jBTt3"}],lBDcT:[function(e,t,r,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");function i(e){return void 0!==e.BS_PRIVATE_NESTED_SOME_NONE}function a(e){return void 0===e?{BS_PRIVATE_NESTED_SOME_NONE:0}:null!==e&&void 0!==e.BS_PRIVATE_NESTED_SOME_NONE?{BS_PRIVATE_NESTED_SOME_NONE:e.BS_PRIVATE_NESTED_SOME_NONE+1|0}:e}function u(e){if(null!=e)return a(e)}function c(e){if(void 0!==e)return a(e)}function s(e){if(null!==e)return a(e)}function l(e){if(null===e||void 0===e.BS_PRIVATE_NESTED_SOME_NONE)return e;var t=e.BS_PRIVATE_NESTED_SOME_NONE;if(0!==t)return{BS_PRIVATE_NESTED_SOME_NONE:t-1|0}}function f(e){if(void 0!==e)return l(e)}function p(e){return void 0!==e?e.VAL:e}o.defineInteropFlag(r),o.export(r,"nullable_to_opt",()=>u),o.export(r,"undefined_to_opt",()=>c),o.export(r,"null_to_opt",()=>s),o.export(r,"valFromOption",()=>l),o.export(r,"some",()=>a),o.export(r,"isNested",()=>i),o.export(r,"option_get",()=>f),o.export(r,"option_unwrap",()=>p)},{"@parcel/transformer-js/src/esmodule-helpers.js":"jBTt3"}],"4Dake":[function(e,t,r,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(r),o.export(r,"filter",()=>u),o.export(r,"forEach",()=>c),o.export(r,"getExn",()=>s),o.export(r,"mapOr",()=>l),o.export(r,"mapWithDefault",()=>_),o.export(r,"map",()=>f),o.export(r,"flatMap",()=>p),o.export(r,"getOr",()=>d),o.export(r,"getWithDefault",()=>E),o.export(r,"orElse",()=>v),o.export(r,"isSome",()=>x),o.export(r,"isNone",()=>m),o.export(r,"equal",()=>h),o.export(r,"compare",()=>g);var i=e("rescript/lib/es6/caml_option.js"),a=e("./Core__Error.js");function u(e,t){if(void 0!==e&&t(i.valFromOption(e)))return e}function c(e,t){if(void 0!==e)return t(i.valFromOption(e))}function s(e,t){return void 0!==e?i.valFromOption(e):a.panic(void 0!==t?t:"Option.getExn called for None value")}function l(e,t,r){return void 0!==e?r(i.valFromOption(e)):t}function f(e,t){if(void 0!==e)return i.some(t(i.valFromOption(e)))}function p(e,t){if(void 0!==e)return t(i.valFromOption(e))}function d(e,t){return void 0!==e?i.valFromOption(e):t}function v(e,t){return void 0!==e?e:t}function x(e){return void 0!==e}function m(e){return void 0===e}function h(e,t,r){return void 0===e?void 0===t:void 0!==t&&r(i.valFromOption(e),i.valFromOption(t))}function g(e,t,r){return void 0!==e?void 0!==t?r(i.valFromOption(e),i.valFromOption(t)):1:void 0!==t?-1:0}var _=l,E=d},{"rescript/lib/es6/caml_option.js":"lBDcT","./Core__Error.js":"gydnd","@parcel/transformer-js/src/esmodule-helpers.js":"jBTt3"}],gydnd:[function(e,t,r,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(r),o.export(r,"$$EvalError",()=>i),o.export(r,"$$RangeError",()=>a),o.export(r,"$$ReferenceError",()=>u),o.export(r,"$$SyntaxError",()=>c),o.export(r,"$$TypeError",()=>s),o.export(r,"$$URIError",()=>l),o.export(r,"panic",()=>f);var i={},a={},u={},c={},s={},l={};function f(e){throw Error("Panic! "+e)}},{"@parcel/transformer-js/src/esmodule-helpers.js":"jBTt3"}]},["68WsM"],"68WsM","parcelRequire94c2");
//# sourceMappingURL=Tidy.js.map
